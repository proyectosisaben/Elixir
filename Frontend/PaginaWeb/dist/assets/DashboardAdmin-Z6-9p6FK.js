import{u as C,k as A,r as x,j as e,d as S,l as N,m as F,n as U,o as k,p as T,q as D,s as _,a as L,t as M,v as P}from"./index-B9YQnKgY.js";function I(){const{usuario:i}=C(),m=A(),[a,p]=x.useState({totalUsuarios:0,totalClientes:0,totalVendedores:0,totalGerentes:0,totalAdmin:0,totalPedidos:0,ventasTotales:0}),[G,j]=x.useState([]),[w,g]=x.useState(!0),[v,b]=x.useState(null);x.useEffect(()=>{if(i&&i.rol!=="admin_sistema"){m("/dashboard-admin");return}u();const s=setInterval(u,3e4);return()=>clearInterval(s)},[i,m]);const u=async()=>{try{g(!0);const s=localStorage.getItem("token"),t=s?{Authorization:`Token ${s}`}:{},d=await fetch("http://localhost:8000/api/dashboard-admin/estadisticas/",{headers:t,credentials:"include"});if(d.ok){const r=await d.json();if(r.success&&r.estadisticas){const o=r.estadisticas;p({totalUsuarios:o.usuarios.total,totalClientes:o.usuarios.por_rol.cliente,totalVendedores:o.usuarios.por_rol.vendedor,totalGerentes:o.usuarios.por_rol.gerente,totalAdmin:o.usuarios.por_rol.admin_sistema,totalPedidos:o.ventas.total_pedidos,ventasTotales:o.ventas.total_ventas})}}else console.log("Error en respuesta de estadísticas:",d.status),await f();const c=await fetch("http://localhost:8000/api/listar-clientes/",{headers:t,credentials:"include"}),n=c.ok?await c.json():null;n&&n.clientes&&j(n.clientes),b(null)}catch(s){console.error("Error cargando datos:",s),b("Error al cargar datos del sistema"),await f()}finally{g(!1)}},f=async()=>{try{const s=localStorage.getItem("token"),t=s?{Authorization:`Token ${s}`}:{},d=await fetch("http://localhost:8000/api/listar-clientes/",{headers:t,credentials:"include"}),c=d.ok?await d.json():null;if(c&&c.clientes){const n=c.clientes;j(n);const r={cliente:0,vendedor:0,gerente:0,admin_sistema:0};n.forEach(h=>{const l=h.rol||"cliente";r.hasOwnProperty(l)&&r[l]++});let o=0,y=0;if(i!=null&&i.id)try{const h=await fetch(`http://localhost:8000/api/ventas-totales/?usuario_id=${i.id}`,{headers:t,credentials:"include"});if(h.ok){const l=await h.json();l.success&&l.ventas&&(o=l.ventas.total_ventas||0,y=l.ventas.total_pedidos||0)}}catch(h){console.log("Error cargando ventas totales:",h)}p({totalUsuarios:n.length,totalClientes:r.cliente,totalVendedores:r.vendedor,totalGerentes:r.gerente,totalAdmin:r.admin_sistema,totalPedidos:y,ventasTotales:o})}}catch(s){console.error("Error en fallback:",s)}},E=async()=>{if(window.confirm(`¿Estás seguro de que deseas hacer un backup de la base de datos?

Esto puede tomar algunos minutos.`))try{const s=await fetch("http://localhost:8000/api/backup-sistema/",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await s.json();s.ok?alert(`✓ Backup realizado exitosamente

Archivo guardado en el servidor`):alert(`Error: ${t.message||"No se pudo completar el backup"}`)}catch(s){alert(`Error al hacer backup: ${s.message}`)}},R=()=>{const s=`
CONFIGURACIÓN DE SEGURIDAD DEL SISTEMA

Estado actual:
✓ Autenticación habilitada
✓ Conexión HTTPS (en producción)
✓ Validación de permisos activa
✓ Logs de sistema registrados

Opciones disponibles:
1. Ver logs de seguridad
2. Gestionar sesiones activas
3. Configurar 2FA
4. Auditoría de acceso

Selecciona una opción o cancela.
    `.trim(),t=prompt(s);t==="1"?alert("Función de logs disponible en próximas actualizaciones"):t==="2"?alert("Hay 1 sesión activa del administrador actual"):t==="3"?alert("2FA disponible en próximas actualizaciones"):t==="4"&&alert("Auditoría disponible en próximas actualizaciones")};return w?e.jsx("div",{className:"dashboard-admin-container",children:e.jsx("div",{className:"loading",children:e.jsx("p",{children:"Cargando panel de administración..."})})}):v?e.jsx("div",{className:"dashboard-admin-container",children:e.jsxs("div",{className:"alertas-section",children:[e.jsxs("h2",{children:[e.jsx(S,{})," Error"]}),e.jsx("p",{children:v}),e.jsx("button",{onClick:u,className:"btn btn-primary",children:"Reintentar"})]})}):e.jsxs("div",{className:"dashboard-admin-container",children:[e.jsx("div",{className:"gerente-header",children:e.jsx("div",{className:"gerente-header-content",children:e.jsxs("div",{className:"gerente-welcome",children:[e.jsx(N,{className:"header-icon"}),e.jsxs("div",{children:[e.jsx("h1",{children:"Panel de Administrador del Sistema"}),e.jsx("p",{children:"Control total del sistema, usuarios, ventas y base de datos"})]})]})})}),e.jsxs("div",{className:"gerente-main-container",children:[e.jsxs("div",{className:"metricas-grid",children:[e.jsxs("div",{className:"metrica-card ventas-totales",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Usuarios Totales"}),e.jsx(F,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:a.totalUsuarios}),e.jsx("p",{className:"metrica-periodo",children:"Registrados en el sistema"}),e.jsx("div",{className:"metrica-bar",children:e.jsx("div",{className:"bar-fill",style:{width:"85%",transition:"width 0.8s ease"}})})]}),e.jsxs("div",{className:"metrica-card productos-total",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Pedidos Totales"}),e.jsx(U,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:a.totalPedidos}),e.jsx("p",{className:"metrica-periodo",children:"Órdenes procesadas"}),e.jsx("div",{className:"metrica-bar",children:e.jsx("div",{className:"bar-fill",style:{width:"60%",transition:"width 0.8s ease"}})})]}),e.jsxs("div",{className:"metrica-card clientes",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Ventas Totales"}),e.jsx(k,{className:"metrica-icon"})]}),e.jsxs("p",{className:"metrica-valor",children:["$",a.ventasTotales.toLocaleString("es-CL")]}),e.jsx("p",{className:"metrica-periodo",children:"Ingresos acumulados"}),e.jsx("div",{className:"metrica-bar",children:e.jsx("div",{className:"bar-fill",style:{width:"45%",transition:"width 0.8s ease"}})})]}),e.jsxs("div",{className:"metrica-card margen",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Estado Sistema"}),e.jsx(T,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:"✓ Online"}),e.jsx("p",{className:"metrica-periodo",children:"Funcionando normalmente"}),e.jsx("div",{className:"metrica-bar",children:e.jsx("div",{className:"bar-fill",style:{width:"100%",transition:"width 0.8s ease"}})})]})]}),e.jsxs("div",{className:"productos-section",children:[e.jsxs("h2",{children:[e.jsx(N,{})," Distribución de Usuarios por Rol"]}),e.jsx("div",{className:"productos-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Rol"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Porcentaje"}),e.jsx("th",{children:"Estado"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Clientes"})}),e.jsx("td",{children:a.totalClientes}),e.jsxs("td",{children:[a.totalUsuarios>0?(a.totalClientes/a.totalUsuarios*100).toFixed(1):0,"%"]}),e.jsx("td",{children:e.jsx("span",{style:{background:"rgba(72, 187, 120, 0.1)",color:"var(--success-color)",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold"},children:"Activo"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Vendedores"})}),e.jsx("td",{children:a.totalVendedores}),e.jsxs("td",{children:[a.totalUsuarios>0?(a.totalVendedores/a.totalUsuarios*100).toFixed(1):0,"%"]}),e.jsx("td",{children:e.jsx("span",{style:{background:"rgba(72, 187, 120, 0.1)",color:"var(--success-color)",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold"},children:"Activo"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Gerentes"})}),e.jsx("td",{children:a.totalGerentes}),e.jsxs("td",{children:[a.totalUsuarios>0?(a.totalGerentes/a.totalUsuarios*100).toFixed(1):0,"%"]}),e.jsx("td",{children:e.jsx("span",{style:{background:"rgba(72, 187, 120, 0.1)",color:"var(--success-color)",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold"},children:"Activo"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Administradores"})}),e.jsx("td",{children:a.totalAdmin}),e.jsxs("td",{children:[a.totalUsuarios>0?(a.totalAdmin/a.totalUsuarios*100).toFixed(1):0,"%"]}),e.jsx("td",{children:e.jsx("span",{style:{background:"rgba(245, 101, 101, 0.1)",color:"var(--danger-color)",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold"},children:"Crítico"})})]})]})]})})]}),e.jsxs("div",{className:"productos-section",children:[e.jsxs("h2",{children:[e.jsx(D,{})," Herramientas Administrativas"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[e.jsxs("button",{onClick:()=>m("/admin/roles"),style:{padding:"20px",borderRadius:"10px",border:"none",background:"var(--primary-color)",color:"white",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:s=>s.target.style.transform="translateY(-3px)",onMouseLeave:s=>s.target.style.transform="translateY(0)",children:[e.jsx(_,{style:{marginRight:"10px"}}),"Gestionar Roles"]}),e.jsxs("button",{onClick:()=>m("/dashboard-vendedor"),style:{padding:"20px",borderRadius:"10px",border:"none",background:"#2ecc71",color:"white",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:s=>s.target.style.transform="translateY(-3px)",onMouseLeave:s=>s.target.style.transform="translateY(0)",children:[e.jsx(L,{style:{marginRight:"10px"}}),"Crear Bebida"]}),e.jsxs("button",{onClick:u,style:{padding:"20px",borderRadius:"10px",border:"none",background:"var(--success-color)",color:"white",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:s=>s.target.style.transform="translateY(-3px)",onMouseLeave:s=>s.target.style.transform="translateY(0)",children:[e.jsx(M,{style:{marginRight:"10px"}}),"Recargar Datos"]}),e.jsxs("button",{onClick:E,style:{padding:"20px",borderRadius:"10px",border:"none",background:"var(--warning-color)",color:"white",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:s=>s.target.style.transform="translateY(-3px)",onMouseLeave:s=>s.target.style.transform="translateY(0)",children:[e.jsx(k,{style:{marginRight:"10px"}}),"Backup Sistema"]}),e.jsxs("button",{onClick:R,style:{padding:"20px",borderRadius:"10px",border:"none",background:"var(--secondary-color)",color:"white",fontWeight:"bold",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:s=>s.target.style.transform="translateY(-3px)",onMouseLeave:s=>s.target.style.transform="translateY(0)",children:[e.jsx(P,{style:{marginRight:"10px"}}),"Seguridad"]})]})]})]})]})}export{I as default};
//# sourceMappingURL=DashboardAdmin-Z6-9p6FK.js.map
