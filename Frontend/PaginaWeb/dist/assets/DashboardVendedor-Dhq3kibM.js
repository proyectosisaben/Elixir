import{u as K,r as i,j as e,F as z,a as y,b as A,c as Q,d as W,e as X,f as Y,g as w,h as Z,i as ee}from"./index-B9YQnKgY.js";function ae(){K();const[j,B]=i.useState({productosActivos:0,ventasHoy:0,ingresoMes:0,ordenesPendientes:0,tasaConversion:0,stockBajo:0}),[P,L]=i.useState([]),[R,V]=i.useState(!0),[F,T]=i.useState([]),[_,x]=i.useState(!1),[$,p]=i.useState(!1);i.useState(!1);const[f,k]=i.useState(null),[q,I]=i.useState(0),[a,v]=i.useState({nombre:"",descripcion:"",precio:"",costo:"",stock:"",stock_minimo:"",categoria:"",imagen:null,sku:""}),[D,g]=i.useState(null),[E,S]=i.useState(!1);i.useEffect(()=>{N();const s=setInterval(N,3e4);return()=>clearInterval(s)},[]);const N=async()=>{var s;try{const t=localStorage.getItem("usuario"),n=t?JSON.parse(t):null,l=n==null?void 0:n.id,o=await fetch("http://localhost:8000/api/productos/");if(o.ok){const h=await o.json(),d=h.productos||h||[];L(d);const G=d.filter(c=>c.activo!==!1).length,O=d.filter(c=>c.stock<c.stock_minimo).length,J=d.reduce((c,r)=>{const u=(r.precio-r.costo)*(r.stock>0?Math.min(r.stock,10):0);return c+u},0);let C=0,b=[];if(l)try{const c=await fetch(`http://localhost:8000/api/ventas-totales/?usuario_id=${l}`);if(c.ok){const r=await c.json();r.success&&r.ventas&&(C=r.ventas.total_pedidos_pagados||0,b=((s=r.ventas.productos_vendidos)==null?void 0:s.slice(0,5).map((u,M)=>({id:M+1,cliente:`Cliente ${M+1}`,producto:u.producto__nombre,cantidad:u.cantidad_total,monto:parseFloat(u.ventas_total)||0,fecha:new Date,estado:"completado"})))||[])}}catch(c){console.log("Error cargando ventas totales:",c),C=0,b=[]}B({productosActivos:G,ventasHoy:C,ingresoMes:J,ordenesPendientes:0,tasaConversion:(Math.random()*5+2).toFixed(1),stockBajo:O}),T(b.length>0?b:d.slice(0,5).map((c,r)=>({id:r+1,cliente:`Cliente ${r+1}`,producto:c.nombre,cantidad:Math.floor(Math.random()*3)+1,monto:c.precio*(Math.floor(Math.random()*3)+1),fecha:new Date(Date.now()-(r+1)*60*60*1e3),estado:["completado","enviando","pendiente"][Math.floor(Math.random()*3)]})))}}finally{V(!1)}},m=s=>{const{name:t,value:n}=s.target;v(l=>({...l,[t]:n}))},H=s=>{const t=s.target.files[0];if(t){v(l=>({...l,imagen:t}));const n=new FileReader;n.onloadend=()=>{g(n.result)},n.readAsDataURL(t)}},U=async s=>{s.preventDefault(),S(!0);const t=localStorage.getItem("usuario"),n=t?JSON.parse(t):null,l=n==null?void 0:n.id;if(!l){alert("❌ Error: No se pudo obtener el ID del usuario"),S(!1);return}const o=new FormData;o.append("nombre",a.nombre),o.append("descripcion",a.descripcion),o.append("precio",a.precio),o.append("costo",a.costo),o.append("stock",a.stock),o.append("stock_minimo",a.stock_minimo||5),o.append("categoria",a.categoria),o.append("sku",a.sku),o.append("usuario_id",l),a.imagen&&o.append("imagen",a.imagen);try{const h=await fetch("http://localhost:8000/api/productos/crear/",{method:"POST",body:o}),d=await h.json();h.ok&&d.success?(alert("✅ Producto creado exitosamente"),v({nombre:"",descripcion:"",precio:"",costo:"",stock:"",stock_minimo:"",categoria:"",imagen:null,sku:""}),g(null),x(!1),N()):alert("❌ Error: "+(d.message||"No se pudo crear el producto"))}catch(h){console.error("Error creando producto:",h),alert("❌ Error al crear el producto")}finally{S(!1)}};return e.jsxs("div",{className:"dashboard-vendedor-container",children:[e.jsx("div",{className:"vendedor-header",children:e.jsx("div",{className:"vendedor-header-content",children:e.jsxs("div",{className:"vendedor-welcome",children:[e.jsx(z,{className:"header-icon"}),e.jsxs("div",{children:[e.jsx("h1",{children:"Panel de Vendedor - Botillería Elixir"}),e.jsx("p",{children:"Gestiona tu inventario de bebidas premium y monitorea tus ventas"})]})]})})}),e.jsxs("div",{className:"vendedor-main-container",children:[e.jsxs("div",{className:"metricas-grid",children:[e.jsxs("div",{className:"metrica-card activos",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Productos Activos"}),e.jsx(y,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:j.productosActivos}),e.jsx("span",{className:"metrica-label",children:"Bebidas en catálogo"})]}),e.jsxs("div",{className:"metrica-card vendidos",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Ventas Hoy"}),e.jsx(A,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:j.ventasHoy}),e.jsx("span",{className:"metrica-label",children:"Órdenes procesadas"})]}),e.jsxs("div",{className:"metrica-card ingresos",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Ingreso Mes"}),e.jsx(Q,{className:"metrica-icon"})]}),e.jsxs("p",{className:"metrica-valor",children:["$",j.ingresoMes.toLocaleString("es-CL")]}),e.jsx("span",{className:"metrica-label",children:"Estimado en ganancia"})]}),e.jsxs("div",{className:"metrica-card stock",children:[e.jsxs("div",{className:"metrica-header",children:[e.jsx("h3",{children:"Stock Bajo"}),e.jsx(W,{className:"metrica-icon"})]}),e.jsx("p",{className:"metrica-valor",children:j.stockBajo}),e.jsx("span",{className:"metrica-label",children:"Productos con stock mínimo"})]})]}),e.jsxs("div",{className:"productos-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h2",{children:[e.jsx(y,{})," Inventario de Bebidas"]}),e.jsxs("button",{className:"btn-agregar-producto",onClick:()=>x(!_),children:[e.jsx(X,{})," Agregar Bebida"]})]}),R?e.jsx("div",{className:"loading",children:"Cargando inventario..."}):P.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(y,{className:"empty-icon"}),e.jsx("p",{children:"No hay productos disponibles"})]}):e.jsx("div",{className:"productos-tabla",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre de la Bebida"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Categoría"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Stock"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:P.map(s=>{var t;return e.jsxs("tr",{className:s.stock<s.stock_minimo?"stock-bajo":"",children:[e.jsx("td",{children:s.nombre}),e.jsx("td",{children:s.sku}),e.jsx("td",{children:((t=s.categoria)==null?void 0:t.nombre)||"Sin categoría"}),e.jsxs("td",{children:["$",s.precio.toLocaleString("es-CL")]}),e.jsx("td",{children:e.jsx("span",{className:s.stock<s.stock_minimo?"stock-warning":"stock-ok",children:s.stock})}),e.jsx("td",{children:e.jsxs("button",{className:"btn-editar",onClick:()=>{k(s),I(s.stock),p(!0)},children:[e.jsx(Y,{})," Ajustar Stock"]})})]},s.id)})})]})})]}),_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Crear Nuevo Producto"}),e.jsx("button",{className:"btn-close",onClick:()=>{x(!1),g(null)},children:e.jsx(w,{})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre de la Bebida"}),e.jsx("input",{type:"text",name:"nombre",value:a.nombre,onChange:m,placeholder:"Ej: Vino Tinto",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SKU"}),e.jsx("input",{type:"text",name:"sku",value:a.sku,onChange:m,placeholder:"Ej: VT001",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{name:"descripcion",value:a.descripcion,onChange:m,placeholder:"Descripción del producto",rows:"3"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Precio de Venta"}),e.jsx("input",{type:"number",name:"precio",value:a.precio,onChange:m,placeholder:"0.00",step:"0.01",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Costo Unitario"}),e.jsx("input",{type:"number",name:"costo",value:a.costo,onChange:m,placeholder:"0.00",step:"0.01",required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stock Inicial"}),e.jsx("input",{type:"number",name:"stock",value:a.stock,onChange:m,placeholder:"0",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stock Mínimo"}),e.jsx("input",{type:"number",name:"stock_minimo",value:a.stock_minimo,onChange:m,placeholder:"5",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Imagen"}),e.jsx("input",{type:"file",name:"imagen",onChange:H,accept:"image/*"}),D&&e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:D,alt:"Preview"})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:E,children:E?"⏳ Guardando...":"✅ Crear Producto"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{x(!1),g(null),v({nombre:"",descripcion:"",precio:"",stock:"",categoria:"",imagen:null,sku:""})},children:"Cancelar"})]})]})})]})}),$&&f&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Ajustar Stock - ",f.nombre]}),e.jsx("button",{className:"btn-close",onClick:()=>{p(!1),k(null)},children:e.jsx(w,{})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Stock Actual: ",f.stock]}),e.jsx("input",{type:"number",value:q,onChange:s=>I(parseInt(s.target.value)),min:"0"})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs("button",{className:"btn-confirmar",onClick:()=>{p(!1),N()},children:[e.jsx(Z,{})," Confirmar"]}),e.jsxs("button",{className:"btn-cancelar",onClick:()=>{p(!1),k(null)},children:[e.jsx(w,{})," Cancelar"]})]})]})}),e.jsxs("div",{className:"ventas-recientes-section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("h2",{children:[e.jsx(ee,{})," Ventas Recientes"]})}),F.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(A,{className:"empty-icon"}),e.jsx("p",{children:"No hay ventas registradas aún"})]}):e.jsx("div",{className:"ventas-tabla",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Monto"}),e.jsx("th",{children:"Hora"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:F.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.cliente}),e.jsx("td",{children:s.producto}),e.jsx("td",{children:s.cantidad}),e.jsxs("td",{children:["$",s.monto.toLocaleString("es-CL")]}),e.jsx("td",{children:s.fecha.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{children:e.jsx("span",{className:`estado-badge ${s.estado}`,children:s.estado})})]},s.id))})]})})]})]})]})}export{ae as default};
//# sourceMappingURL=DashboardVendedor-Dhq3kibM.js.map
